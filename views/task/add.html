<div class="row">
    <div class="span12">

        <div class="widget ">
            <div class="widget-header">
                <i class="icon-plus"></i>
                <h3>添加任務</h3>
            </div> <!-- /widget-header -->

            <div class="widget-content">

                <div class="alert alert-danger hide" role="alert"></div>

                <form id="add-task" action="{{urlfor "TaskController.Add"}}" method="post" class="form-horizontal">
                    <fieldset>

                        <div class="control-group">
                            <label class="control-label" for="task_name">任务名称</label>
                            <div class="controls">
                                <input type="text" name="task_name" class="span6" id="task_name">
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="description">任務說明</label>
                            <div class="controls">
                                <textarea name="description" class="span6" id="description" rows="3"></textarea>
                            </div> <!-- /controls -->
                        </div> <!-- /control-group -->

                        <div class="control-group">
                            <label class="control-label" for="group_id">分组</label>
                            <div class="controls">
                                <select name="group_id" id="group_id">
                                    <option value="0">未分组</option>
                                    {{range $k, $v := .groups}}
                                        <option value="{{$v.Id}}">{{$v.GroupName}}</option>
                                    {{end}}
                                </select>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">是否只允許一個實例</label>
                            <div class="controls">
                                <label class="radio inline">
                                    <input type="radio" value="0" name="concurrent" checked> 是
                                </label>
                                <label class="radio inline">
                                    <input type="radio" value="1" name="concurrent"> 否
                                </label>
                                <p class="help-block">設為“是”的話，如果該任務在上一個時間點還沒執行完，則略過不執行</p>
                            </div>    <!-- /controls -->
                        </div> <!-- /control-group -->

                        <div class="control-group">
                            <label class="control-label" for="cron_spec">cron表達式</label>
                            <div class="controls">
                                <input type="text" name="cron_spec" class="span6" id="cron_spec" value="">
                                <a href="{{urlfor "HelpController.Index"}}" target="_blank">參見使用幫助</a>
                            </div> <!-- /controls -->
                        </div> <!-- /control-group -->


                        <div class="control-group">
                            <label class="control-label" for="command">命令脚本</label>
                            <div class="controls">
                                <textarea name="command" class="span6" id="command" rows="6"></textarea>
                            </div> <!-- /controls -->
                        </div> <!-- /control-group -->

                        <div class="control-group">
                            <label class="control-label" for="timeout">超時設置</label>
                            <div class="controls">
                                <input type="text" name="timeout" class="span1" id="timeout" value="0"> 秒
                                <span class="help-block">不設置的話，默認超時時間為1天</span>
                            </div> <!-- /controls -->
                        </div> <!-- /control-group -->

                        <div class="control-group">
                            <label class="control-label">邮件通知</label>
                            <div class="controls">
                                <label class="radio inline">
                                    <input type="radio" value="0" name="notify" checked> 不通知
                                </label>
                                <label class="radio inline">
                                    <input type="radio" value="1" name="notify"> 執行失敗時通知
                                </label>
                                <label class="radio inline">
                                    <input type="radio" value="2" name="notify"> 執行結束時通知
                                </label>
                            </div>    <!-- /controls -->
                        </div> <!-- /control-group -->

                        <div class="control-group notify_email hide">
                            <label class="control-label" for="notify_email">通知郵件抄送人</label>
                            <div class="controls">
                                <textarea name="notify_email" class="span6" id="notify_email" rows="6"></textarea>
                                <p class="help-block">每行一個email地址，如果不需要抄送給其他人請留空</p>
                            </div> <!-- /controls -->
                        </div> <!-- /control-group -->
                        <br/>

                        <div class="form-actions">
                            <button type=“ submit” class=“ btn btn-primary”>保存</button>
                            <a href="{{urlfor "TaskController.List"}}" class="btn">返回</a>
                        </div> <!-- /form-actions -->
                    </fieldset>
                </form>

            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $("form").submit(function () {
            $(".alert").hide();
            $("button[type='submit']").attr('disabled', true);
            $.post('{{urlfor "TaskController.Add"}}', $(this).serialize(), function (out) {
                if (out.status == 0) {
                    window.location.href = '{{urlfor "TaskController.List"}}';
                } else {
                    $(".alert").text(out.msg);
                    $(".alert").show();
                    $("button[type='submit']").attr('disabled', false);
                }
            }, "json");
            return false;
        });
        $("input[name='notify']").click(function () {
            if ($(this).val() > 0) {
                $('.notify_email').removeClass('hide');
            } else {
                $('.notify_email').addClass('hide');
            }
        });
    });
</script>